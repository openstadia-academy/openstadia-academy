# Задание 3

## Подготовка

Выполнить подготовки из Заданий 1 и 2

## Задание

Добавить в систему функциональность по добавлению пользователей к серверу. Сервер должен поддерживать функциональность генерации Invite ссылок, перейдя по которой другой авторизированный пользователь получает доступ к серверу в роли Пользователя.

### Требования к web порталу

- На странице с настройкой сервера у пользователей с уровнем доступа READ_SETTINGS или WRITE_SETTINGS должна появиться вкладка Server Accesses со списком всех пользователей, имеющим доступ к данному серверу, отображением их ролей. Пользователи с уровнем доступа WRITE_SETTINGS имеют возможность удаления пользователя с сервера (кроме удаления владельца сервера)

  ![изображение](/task3/image001.png)

- Пользователи, не имеющие доступ к серверу в роли READ_SETTINGS или WRITE_SETTINGS, не имеют доступ к странице настроек сервера.

- Для добавления пользователей к серверу пользователь в роли WRITE_SETTINGS может сгенерировать Invite ссылку. Ссылка имеет время истечения срока действия (по умолчанию 7 дней) и может быть активирована только один раз. После генерации ссылки пользователю отображается окно с URL ссылкой, которую пользователь может скопировать для передачи другому пользователю.

- В случае перехода по Invite ссылке пользователю должно открываться информационное окно, оповещающее пользователя о добавлении к новому серверу. Если данный токен не доступен для активации, то пользователь должен быть об этом уведомлен. Если токен доступен для активации и пользователь нажимает на кнопку согласия пользователю добавляется новый сервер, а браузер переходит к списку серверов.

### Требования к backend сервису

1. Invite Token представляет собой строку длины 32, которая сгенерирована с использованием `secrets.token_urlsafe(32)`

2. Система должна иметь обработчик по пути **GET /servers/{server_id}/invite** которая результатом своего выполнения должна возвращает пользователю уникальный Invite Token. Информация об invite токене должна сохраняться в базе данных. Система должна проверить, обладает ли пользователь правами WRITE_SETTINGS для данного сервера. Следующая информация должна быть создана в базе данных:

    - Создатель токена
    - Сервер для токена
    - Дата и время создания
    - Дата и время истечения срока действия
    - Активирован ли токен
    - Дата и время активации
    - Пользователь, который активировал токен

3. Система должна иметь обработчик по пути **POST /servers/{server_id}/invite**, в теле которого передаётся ранее сгенерированный Invite Token. Для данного токена проверяется:

    - активирован ли токен на данный момент
    - имеет ли создатель токена на момент проверки токена уровень доступа WRITE_SETTINGS для этого сервера
    - не истекло ли время действия токена
    - не присоединен ли данный пользователь к серверу на данный момент

   > В случае успешной проверки пользователь подключается к данному серверу в роли пользователя, в ином случае токен не изменяется и продолжает быть действительным.

4. Система должна иметь обработчик по пути **POST /servers/{server_id}/invite/info**, в теле которого передаётся ранее сгенерированный Invite Token. Ответом на данный обработчик должна быть информация о токене:

    - Создатель токена
    - Сервер для токена
    - Может ли токен быть активирован данным пользователем (см. параметры для валидации в пункте 3)
