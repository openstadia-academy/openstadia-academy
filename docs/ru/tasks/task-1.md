# Задание 1

## Что должно быть сделано

- Зарегистрированы на
    - GitHub
- Установлены
    - Git
    - Docker Desktop
    - PyCharm Community Edition
    - ToolBox (Опционально)

## Подготовка

- Скачать и установить (если не установлены):
    - [Postman](https://www.postman.com/downloads/)
    - [Python](https://www.python.org/downloads/) (Версии 3.9-3.11)
    - [Poetry](https://www.python.org/downloads/)

- Из IDE Pycharm загрузить репозиторий openstadia-hub с использованием функции **Get From VCS**. В поле URL
  ввести: <https://github.com/openstadia-academy/openstadia-hub.git>

- Изменить ветку проекта на **hw2**

- Выполнить команду для установки зависимостей:

```
poetry install  
```

- В **корневой папке** (дальше все папки относительно корня проекта будут начинаться со слэша «/») создать файл **.env**
  со следующим содержимым:

```
AUTH0_DOMAIN=openstadia.eu.auth0.com  
AUTH0_AUDIENCE=https://api.openstadia.com   
DATABASE_URL=postgresql://postgres:password@localhost:5432/my_database
```

- В папке **/dev** создать файл **.env** со следующим содержимым:

```
POSTGRES_USER=postgres  
POSTGRES_PASSWORD=password   
POSTGRES_DB=my_database  
```

- Запустить приложение Docker Desktop

- В командной строке перейти в папку **/dev** и запустить docker compose:

```
cd dev
docker compose up -d  
```

- В командной строке, находясь в **корневой папке** проекта запустить сервер

```  
./scripts/run-dev.ps1
```

## Задание

- Создать ендпоинт на сервере, для генерации нового токена доступа для сервера.

- Ендпоинт должен обслуживать метод **POST** на URL **/servers/{server_id}/token**, обработчик должен находиться в файле
  **/openstadia_hub/api/servers.py.** Обработчик должен проверять, имеет ли данный пользователь права работать с данным
  сервером.

- Создать метод, для принятия изменений в базу данных в файле /**openstadia_hub/crud/server.py.** Генерация токена
  осуществляется следующей командой: `token = secrets.token_urlsafe(16)`

- Создать схему для обработчика, возвращаемых данных в файле /**openstadia_hub/schemas/server.py**, который должен
  возвращать JSON данные в следующем формате:

```json
{
  "token": "new-generated-token"
}
```

Где, строка "new-generated-token" -- это новый сгенерированный вашим методом токен.

Проверить работу вашего решения с использованием Postman. Создать запрос POST для URL <http://127.0.0.1:8000/>

## Проверка

1. Залогиньтесь, подтвердите почту и пройдите Onboarding на сайте <https://app.openstadia.com/>
2. Настройте данные для разработки: ![изображение](/task1/image001.png)
    1. Перейдите на вкладку Developer
    2. В поле Hub URL введите: http://127.0.0.1:8000
    3. Нажмите кнопку Update

> Для возврата настроек по умолчание нажмите на кнопку сброса

3. Запустите docker, приложение. Повторно пройдите Onboarding(в вашей локальной базе нет данных пользователя). Теперь
   можете проверять работоспособность своего решения

4. Для проверки работы выполните следующие шаги:
   ![изображение](/task1/image003.png)

   ![изображение](/task1/image004.png)

    1. Создайте новый сервер с любым названием
    2. Зайдите в конфигурацию созданного сервера
    3. При нажатии кнопки регенерации должен отображаться новый токен сервера.
